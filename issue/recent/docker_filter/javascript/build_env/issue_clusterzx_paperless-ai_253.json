{
  "number": 253,
  "title": "PUID/PGID Support",
  "created_at": "2025-01-27T20:24:48Z",
  "closed_at": "2025-01-27T21:06:05Z",
  "labels": [],
  "url": "https://github.com/clusterzx/paperless-ai/issues/253",
  "body": "**Is your feature request related to a problem? Please describe.**\nObjective to drop/reduce root priviledges.\n\n**Describe the solution you'd like**\n\ncompose.yaml\n```\nservices:\n  paperless-ai:\n    image: clusterzx/paperless-ai\n    container_name: paperless-ai\n    restart: unless-stopped\n    cap_drop:\n      - ALL\n    security_opt:\n      - no-new-privileges=true\n    environment:\n      - PUID:1000\n      - PGID:1000\n    ports:\n      - 3000:3000\n    volumes:\n      - paperless-ai_data:/app/data\n\nvolumes:\n  paperless-ai_data:\n```",
  "comments_url": "https://api.github.com/repos/clusterzx/paperless-ai/issues/253/comments",
  "author": "truthsword",
  "comments": [
    {
      "user": "clusterzx",
      "created_at": "2025-01-27T21:06:05Z",
      "body": "Added your config. Thank you for the good issue.\n"
    },
    {
      "user": "GyroGearl00se",
      "created_at": "2025-01-28T14:48:12Z",
      "body": "services.paperless-ai.environment.[0]: unexpected type map[string]interface {}\n\nenvironment should look like:\n\n\nenvironment:\n      - PUID=1000\n      - PGID=1000\n\n\n"
    },
    {
      "user": "truthsword",
      "created_at": "2025-01-28T15:28:21Z",
      "body": "@clusterzx Remove the space after the PUID/PGID colon (fixed above)\n```\nservices:\n  paperless-ai:\n    image: clusterzx/paperless-ai\n    container_name: paperless-ai\n    restart: unless-stopped\n    cap_drop:\n      - ALL\n    security_opt:\n      - no-new-privileges=true\n    environment:\n      - PUID:1000\n      - PGID:1000\n    ports:\n      - 3000:3000\n    volumes:\n      - paperless-ai_data:/app/data\n\nvolumes:\n```"
    }
  ],
  "satisfaction_conditions": [
    "Environment variables must be formatted using valid YAML syntax for Docker Compose",
    "Solution must allow specifying non-root user/group IDs through environment variables",
    "Configuration must maintain security hardening measures",
    "Docker Compose structure must be syntactically valid"
  ],
  "_classification": {
    "category": "Can be dockerized without any issue",
    "timestamp": "2025-04-05 01:46:37"
  },
  "git_commit_info": {
    "sha": "ab207fa335f5985312771ff14d0835f85ed8f346",
    "date": "2025-01-26T23:55:11Z",
    "message": "Merge branch 'main' of https://github.com/clusterzx/paperless-ai",
    "author": "Clusterzx"
  },
  "repository_info": {
    "structure_summary": ".\n./.git\n./.git/branches\n./.git/description\n./.git/hooks\n./.git/hooks/applypatch-msg.sample\n./.git/hooks/commit-msg.sample\n./.git/hooks/post-update.sample\n./.git/hooks/pre-applypatch.sample\n./.git/hooks/pre-commit.sample\n./.git/hooks/pre-merge-commit.sample\n./.git/hooks/pre-push.sample\n./.git/hooks/pre-receive.sample\n./.git/hooks/push-to-checkout.sample\n./.git/hooks/update.sample\n./.git/hooks/fsmonitor-watchman.sample\n./.git/hooks/pre-rebase.sample\n./.git/hooks/prepare-commit-msg.sample\n./.git/hooks/sendemail-validate.sample\n./.git/info\n./.git/info/exclude\n./.git/config\n./.git/objects\n./.git/objects/pack\n./.git/objects/pack/pack-bd477fa4499ee6bc659630ce5f90a838f1198584.pack\n./.git/objects/pack/pack-bd477fa4499ee6bc659630ce5f90a838f1198584.rev\n./.git/objects/pack/pack-bd477fa4499ee6bc659630ce5f90a838f1198584.idx\n./.git/objects/info\n./.git/HEAD\n./.git/refs\n./.git/refs/heads\n./.git/refs/heads/main\n./.git/refs/tags\n./.git/refs/remotes\n./.git/refs/remotes/origin\n./.git/refs/remotes/origin/HEAD\n./.git/packed-refs\n./.git/logs\n./.git/logs/refs\n./.git/logs/refs/remotes\n./.git/logs/refs/remotes/origin\n./.git/logs/refs/remotes/origin/HEAD\n./.git/logs/refs/heads\n./.git/logs/refs/heads/main\n./.git/logs/HEAD\n./.git/index\n./.env.example\n./.github\n./.github/FUNDING.yml\n./.github/ISSUE_TEMPLATE\n./.github/ISSUE_TEMPLATE/feature_request.md\n./.github/ISSUE_TEMPLATE/bug_report.md\n./.github/workflows\n./.github/workflows/docker-build-push.yml\n./.github/workflows/stale.yml\n./CODE_OF_CONDUCT.md\n./CONTRIBUTING.md\n./LICENSE\n./PRIVACY_POLICY.md\n./config\n./config/config.js\n./dashboard.png\n./docs\n./docs/README.md\n./docs/index.html\n./ecosystem.config.js\n./eslint.config.mjs\n./models\n./models/document.js\n./prettierrc.json\n./preview.png\n./public\n./public/css\n./public/css/settings.css\n./public/css/chat.css\n./public/css/dashboard.css\n./public/css/setup.css\n./public/js\n./public/js/history.js\n./public/js/manual.js\n./public/js/playground-analyzer.js\n./public/js/chat.js\n./public/js/dashboard.js\n./public/js/playground.js\n./public/js/settings.js\n./public/js/setup.js\n./routes\n./routes/auth.js\n./routes/setup.js\n./services\n./services/debugService.js\n./services/documentsService.js\n./services/loggerService.js\n./services/aiServiceFactory.js\n./services/chatService.js\n./services/customService.js\n./services/manualService.js\n./services/ollamaService.js\n./services/openaiService.js\n./services/paperlessService.js\n./services/setupService.js\n./setup.png\n./views\n./views/debug.ejs\n./views/index.ejs\n./views/layout.ejs\n./views/manual.ejs.bak\n./views/template.ejs\n./views/chat.ejs\n./views/dashboard.ejs\n./views/history.ejs\n./views/login.ejs\n./views/manual.ejs\n./views/playground.ejs\n./views/settings.ejs\n./views/setup.ejs\n./.dockerignore\n./.gitignore\n./Dockerfile\n./README.md\n./SECURITY.md\n./docker-compose.yml\n./package-lock.json\n./package.json\n./paperless-ai-chrome-extension.zip\n./server.js\n",
    "readme": "\n--- ./docs/README.md ---\n \n\n\n\n--- ./README.md ---\n![GitHub commit activity](https://img.shields.io/github/commit-activity/t/clusterzx/paperless-ai) ![Docker Pulls](https://img.shields.io/docker/pulls/clusterzx/paperless-ai) ![GitHub User's stars](https://img.shields.io/github/stars/clusterzx) ![GitHub License](https://img.shields.io/github/license/clusterzx/paperless-ai?cacheSeconds=1)\n\n\n\n# Paperless-AI\n\nAn automated document analyzer for Paperless-ngx using OpenAI API, Ollama and all OpenAI API compatible Services to automatically analyze and tag your documents. \\\nIt features: Automode, Manual Mode, Ollama and OpenAI, a Chat function to query your documents with AI, a modern and intuitive Webinterface. \\\n\\\n**Following Services and OpenAI API compatible services have been successfully tested:**\n- Ollama\n- OpenAI\n- DeepSeek.ai\n- OpenRouter.ai\n- Perplexity.ai\n- Together.ai\n- VLLM\n- LiteLLM\n- Fastchat\n- Gemini (Google)\n- ... and there are possibly many more\n\n### Disclaimer:\npaperless-ai makes changes to the documents (not the content, the meta data) in your productive paperlessNGX instance that cannot be easily undone.\nDo the configuration carefully and think twice. \nPlease test the results beforehand in a separate development environment and be sure to back up your documents and metadata beforehand. \n\n## We have a chrome extension now to work right out of paperless-ngx itself for Document Chat!\nDownload here: https://github.com/clusterzx/paperless-ai/blob/main/paperless-ai-chrome-extension.zip\n\n## We exploded! \ud83d\udca5\n\ud83d\udc9a Thank you for all your support, bug submit, feature requests \ud83d\udc9a\n<picture>\n  <source\n    media=\"(prefers-color-scheme: dark)\"\n    srcset=\"\n      https://api.star-history.com/svg?repos=clusterzx/paperless-ai&type=Date&theme=dark\n    \"\n  />\n  <source\n    media=\"(prefers-color-scheme: light)\"\n    srcset=\"\n      https://api.star-history.com/svg?repos=clusterzx/paperless-ai&type=Date\n    \"\n  />\n  <img\n    alt=\"Star History Chart\"\n    src=\"https://api.star-history.com/svg?repos=clusterzx/paperless-ai&type=Date\"\n  />\n</picture>\n\n## IMPORTANT:\nIf you upgrade from 1.x to 2.1.x or later:\n1. You are now forced to setup a user as the Webapp now requires authentication. I know many of you only use it in secured and encapsulated networks and don't care for authentication. But I think we all do good when we secure out data as much as possible.\n2. You have to set the username the token key belongs to. There were so many bugs and issues that were traced back to Documents having other user/access rights then the api key could provide.\n3. Thanks for listening, love ya!\n\n## Features\n\n### Automated Document Management\n- **Automatic Scanning**: Identifies and processes new documents within Paperless-ngx.\n- **AI-Powered Analysis**: Leverages OpenAI API and Ollama (Mistral, Llama, Phi 3, Gemma 2) for precise document analysis.\n- **Metadata Assignment**: Automatically assigns titles, tags, document_type and correspondent details.\n\n### Advanced Customization Options\n- **Predefined Processing Rules**: Specify which documents to process based on existing tags. *(Optional)* \ud83c\udd95\n- **Selective Tag Assignment**: Use only selected tags for processing. *(Disables the prompt dialog)* \ud83c\udd95\n- **Custom Tagging**: Assign a specific tag (of your choice) to AI-processed documents for easy identification. \ud83c\udd95\n\n### Manual Mode\n- **AI-Assisted Analysis**: Manually analyze documents with AI support in a modern web interface. *(Accessible via the `/manual` endpoint)* \ud83c\udd95\n\n### Interactive Chat Functionality\n- **Document Querying**: Ask questions about your documents and receive accurate, AI-generated answers. \ud83c\udd95\n\n### Intuitive Web Interface\n- **Streamlined Configuration**: Easy-to-use setup interface available at `/setup`.\n- **Dashboard Overview**: A clean and organized dashboard for monitoring and managing document processing.\n\n### Reliability and Security\n- **Error Handling**: Automatic restarts and health monitoring for improved stability.\n- **Health Checks**: Ensures system integrity and alerts on potential issues.\n- **Docker Integration**: Full Docker support, including health checks, resource management, and persistent data storage.\n\n## Prerequisites\n\n- Docker and Docker Compose\n- Access to a Paperless-ngx installation\n- Cloud based LLM access (see list on top) or your own Ollama or other selfhosted LLM instance with your chosen model running and reachable.\n- Basic understanding of cron syntax (for scan interval configuration)\n\n## Installation\n\nVisit the Wiki for installation:\\\n[Click here for Installation](https://github.com/clusterzx/paperless-ai/wiki/Installation)\n-------------------------------------------\n\n\n## How it Works\n\n1. **Document Discovery**\n   - Periodically scans Paperless-ngx for new documents\n   - Tracks processed documents in a local SQLite database\n\n2. **AI Analysis**\n   - Sends document content to OpenAI API or Ollama for analysis\n   - Extracts relevant tags and correspondent information\n   - Uses GPT-4o-mini or your custom Ollama model for accurate document understanding\n\n3. **Automatic Organization**\n   - Creates new tags if they don't exist\n   - Creates new correspondents if they don't exist\n   - Updates documents with analyzed information\n   - Marks documents as processed to avoid duplicate analysis\n\n## NEW! Manual Mode\nYou can now manually analyze your files by hand with the help of AI in a beautiful Webinterface.\nReachable via the ```/manual``` endpoint from the webinterface.\n\n## NEW Dashboard:\n![Dashboard Image](./dashboard.png)\n\n## Configuration Options\n\nThe application can be configured through the Webinterface on the ```/setup``` Route.\nYou dont need/can't set the environment vars through docker.\n\n![Setup Image](./setup.png)\n\n## Docker Support\n\nThe application comes with full Docker support:\n\n- Automatic container restart on failure\n- Health monitoring\n- Volume persistence for database\n- Resource management\n- Graceful shutdown handling\n\n### Docker Commands\n\n```bash\n# Start the container\ndocker-compose up -d\n\n# View logs\ndocker-compose logs -f\n\n# Restart container\ndocker-compose restart\n\n# Stop container\ndocker-compose down\n\n# Rebuild and start\ndocker-compose up -d --build\n```\n\n## Health Checks\n\nThe application provides a health check endpoint at `/health` that returns:\n\n```json\n# Healthy system\n{\n  \"status\": \"healthy\"\n}\n\n# System not configured\n{\n  \"status\": \"not_configured\",\n  \"message\": \"Application setup not completed\"\n}\n\n# Database error\n{\n  \"status\": \"database_error\",\n  \"message\": \"Database check failed\"\n}\n```\n\n## Debug Interface\n\nThe application includes a debug interface accessible via `/debug` that helps administrators monitor and troubleshoot the system's data:\n\n- \ud83d\udd0d View all system tags\n- \ud83d\udcc4 Inspect processed documents\n- \ud83d\udc65 Review correspondent information\n\n### Accessing the Debug Interface\n\n1. Navigate to:\n```\nhttp://your-instance:3000/debug\n```\n\n2. The interface provides:\n   - Interactive dropdown to select data category\n   - Tree view visualization of JSON responses\n   - Color-coded data representation\n   - Collapsible/expandable data nodes\n\n### Available Debug Endpoints\n\n| Endpoint | Description |\n|----------|-------------|\n| /debug/tags | Lists all tags in the system |\n| /debug/documents | Shows processed document information |\n| /debug/correspondents | Displays correspondent data |\n\n### Health Check Integration\n\nThe debug interface also integrates with the health check system, showing a configuration warning if the system is not properly set up.\n\n## Development\n\nTo run the application locally without Docker:\n\n1. Install dependencies:\n```bash\nnpm install\n```\n\n2. Start the development server:\n```bash\nnpm run test\n```\n\n## Contributing\n\n1. Fork the repository\n2. Create your feature branch (`git checkout -b feature/AmazingFeature`)\n3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)\n4. Push to the branch (`git push origin feature/AmazingFeature`)\n5. Open a Pull Request\n\n## Security Considerations\n\n- Store API keys securely\n- Restrict container access\n- Monitor API usage\n- Regularly update dependencies\n- Back up your database\n\n## License\n\nThis project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.\n\n## Acknowledgments\n\n- [Paperless-ngx](https://github.com/paperless-ngx/paperless-ngx) for the amazing document management system\n- OpenAI API\n- The Express.js and Node.js communities for their excellent tools\n\n## Support\n\nIf you encounter any issues or have questions:\n\n1. Check the [Issues](https://github.com/clusterzx/paperless-ai/issues) section\n2. Create a new issue if yours isn't already listed\n3. Provide detailed information about your setup and the problem\n\n## Roadmap\n\n- [x] Support for custom AI models\n- [x] Support for multiple language analysis\n- [x] Advanced tag matching algorithms\n- [ ] Custom rules for document processing\n- [ ] Enhanced web interface with statistics\n\n\n\n",
    "readme_filenames": [
      "./docs/README.md",
      "./README.md",
      "./.github/ISSUE_TEMPLATE/feature_request.md"
    ],
    "dockerfile": "\n--- ./Dockerfile ---\nFROM node:latest\n# FROM node:20-slim\n\nWORKDIR /app\n\n# Install system dependencies\nRUN apt-get update && \\\n    apt-get install -y python3 make g++ curl && \\\n    apt-get clean && \\\n    rm -rf /var/lib/apt/lists/*\n\n# Install PM2 globally\nRUN npm install pm2 -g\n\n# Copy package files\nCOPY package*.json ./\n\n# Install dependencies\nRUN npm install\n\n# Copy application files\nCOPY . .\n\n# Create volume mount points\nVOLUME [\"/app/data\"]\n\n# Expose port\nEXPOSE 3000\n\n# Copy PM2 configuration\nCOPY ecosystem.config.js .\n\n# Start the application with PM2\nCMD [\"pm2-runtime\", \"ecosystem.config.js\"]\n\n",
    "dockerfile_paths": [
      "./Dockerfile"
    ],
    "github_workflows": {
      ".github/workflows/docker-build-push.yml": "on:\n  release:\n    types: [published]  # Only triggers when a release is published\n  schedule:\n    - cron: \"0 0 * * *\" # Nightly build\njobs:\n  docker:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v3\n        with:\n          fetch-depth: 0\n          \n      - name: Set up QEMU\n        uses: docker/setup-qemu-action@v2\n        \n      - name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v2\n        \n      - name: Log in to Docker Hub\n        uses: docker/login-action@v2\n        with:\n          username: ${{ secrets.DOCKER_USERNAME }}\n          password: ${{ secrets.DOCKER_PASSWORD }}\n          \n      - name: Login to GitHub Container Registry\n        uses: docker/login-action@v2\n        with:\n          registry: ghcr.io\n          username: ${{ github.repository_owner }}\n          password: ${{ secrets.GHCR_PAT }}\n          \n      - name: Extract metadata\n        id: meta\n        uses: docker/metadata-action@v4\n        with:\n          images: |\n            ${{ secrets.DOCKER_USERNAME }}/paperless-ai\n            ghcr.io/${{ github.repository_owner }}/paperless-ai\n          tags: |\n            type=schedule,pattern=nightly\n            type=semver,pattern={{version}},enable=${{ github.event_name == 'release' }}\n            type=raw,value=latest,enable=${{ github.event_name == 'release' }}\n            \n      - name: Build and push\n        uses: docker/build-push-action@v4\n        with:\n          context: .\n          push: true\n          platforms: linux/amd64,linux/arm64\n          tags: ${{ steps.meta.outputs.tags }}\n          labels: ${{ steps.meta.outputs.labels }}\n",
      ".github/workflows/stale.yml": "name: Mark stale issues and pull requests\n\non:\n  schedule:\n    - cron: \"0 0 * * *\" # Runs daily at midnight\n\njobs:\n  stale:\n    runs-on: ubuntu-latest\n\n    steps:\n    - name: Close stale issues and pull requests\n      uses: actions/stale@v8\n      with:\n        repo-token: ${{ secrets.stale_bot }}\n        stale-issue-message: \"This issue has been marked as stale due to inactivity. Please respond to keep it open.\"\n        stale-pr-message: \"This pull request has been marked as stale due to inactivity. Please update it to keep it open.\"\n        close-issue-message: \"This issue has been closed due to lack of response.\"\n        close-pr-message: \"This pull request has been closed due to lack of response.\"\n        days-before-stale: 7 # Days before an issue or PR is marked as stale\n        days-before-close: 3 # Days before a stale issue or PR is closed\n        stale-issue-label: \"stale\" # Label added to stale issues\n        exempt-issue-labels: \"wontfix,bug\" # Labels that exempt issues from being marked as stale\n        only-issues: true # Only affect issues, not PRs\n"
    }
  },
  "llm_calls_before_build": 10,
  "github_workflows_found": [
    ".github/workflows/docker-build-push.yml",
    ".github/workflows/stale.yml"
  ],
  "dockerfile": "FROM node:22-slim\n\nWORKDIR /app\n\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends \\\n    git \\\n    python3 \\\n    make \\\n    g++ \\\n    curl \\\n    ca-certificates && \\\n    apt-get clean && \\\n    rm -rf /var/lib/apt/lists/*\n\nRUN git clone https://github.com/clusterzx/paperless-ai . && \\\n    git checkout ab207fa335f5985312771ff14d0835f85ed8f346\n\nRUN chown -R node:node /app\n\nUSER node\n\nRUN npm install\n\nENV PUID=1000\nENV PGID=1000\n\nEXPOSE 3000\n\nCMD [\"tail\", \"-f\", \"/dev/null\"]",
  "dockerfile_source": "Repository at Dockerfile",
  "dockerfile_attempt_1": 1,
  "dockerfile_build_success": true,
  "llm_calls_total": 20
}