{
  "number": 2593,
  "title": "Router mergeParams=true does not work ",
  "created_at": "2015-03-14T17:41:11Z",
  "closed_at": "2015-03-14T17:57:04Z",
  "labels": [
    "question"
  ],
  "url": "https://github.com/expressjs/express/issues/2593",
  "body": "express 4.12.2. According to the Router doc about `mergeParams` option:\n\n> Preserve the `req.params` values from the parent router. If the parent and the child have conflicting param names, the child\u2019s value take precedence.\n\nMay be I miss something, but it does not behave in that way at all:\n\n``` javascript\nvar express = require('express');\nvar app = express();\n\n\napp.get('/users/:username', function(req, res, next) {\n        console.log('> app.get');\n\n    if (req.params.username !== 'alice') {\n        throw new Error('app.get: username != alice');\n    }\n\n    next();\n});\n\nvar router1 = express.Router({mergeParams: true});\napp.use(router1);\n\nrouter1.get('*', function(req, res, next) {\n        console.log('> router1.get');\n\n        // This throws.  \n    if (req.params.username !== 'alice') {\n        throw new Error('router1.get: username != alice');\n    }\n\n    next();\n});\n\napp.listen(5000, '0.0.0.0');\n```\n\nNow send a GET request with url \"/users/alice\" and it will print:\n\n```\n> app.get\n> router.get\nError: router1.get: username != alice\n```\n",
  "comments_url": "https://api.github.com/repos/expressjs/express/issues/2593/comments",
  "author": "ibc",
  "comments": [
    {
      "user": "ibc",
      "created_at": "2015-03-14T17:57:04Z",
      "body": "May be `mergeParams` just work when declaring a named param in the mount path of the router?\n\n\n---\n\nYes, sorry for the noise.\n"
    },
    {
      "user": "dougwilson",
      "created_at": "2015-03-14T21:17:08Z",
      "body": "> Yes, sorry for the noise.\n\nI'm not sure if there is such thing as \"noise\" :) So to answer this, what `mergeParams` does is merge any `req.params` that _exists at the time the router is entered_. The reason it wasn't doing anything in your example above is because `app.use(router1);` does not have any parameters. You can see this by doing something like `app.use(function (req, res, next) { console.dir(req.params); next() })` and seeing it as nothing there.\n\nTo expand on your example, there are two possible solutions to achieve this, and the correct one for your situation depends on exactly how you are looking for the sub router to behave:\n\n``` js\nvar express = require('express');\nvar app = express();\n\napp.get('/users/:username', function(req, res, next) {\n        console.log('> app.get');\n\n    if (req.params.username !== 'alice') {\n        throw new Error('app.get: username != alice');\n    }\n\n    next();\n});\n\nvar router1 = express.Router({mergeParams: true});\n// now router1 will actually inherit parameters, since it's defined on a path with them\napp.all('/users/:username', router1);\n\nrouter1.get('*', function(req, res, next) {\n        console.log('> router1.get');\n\n    if (req.params.username !== 'alice') {\n        throw new Error('router1.get: username != alice');\n    }\n\n    next();\n});\n\napp.listen(5000, '0.0.0.0');\n```\n"
    },
    {
      "user": "ibc",
      "created_at": "2015-03-17T11:36:50Z",
      "body": "Clear, thanks a lot.\n"
    },
    {
      "user": "seyedasfar",
      "created_at": "2019-04-14T09:28:33Z",
      "body": "What is the purpose of using mergeParams?"
    },
    {
      "user": "abdoerrahiem",
      "created_at": "2020-07-07T09:08:42Z",
      "body": "> What is the purpose of using mergeParams?\r\n\r\nto use route in another route"
    }
  ],
  "satisfaction_conditions": [
    "Explanation of why mergeParams=true didn't preserve req.params in the original setup",
    "Clear demonstration of how to properly mount a router to inherit parameters",
    "Identification of scenarios where mergeParams provides value",
    "Differentiation between parameter inheritance from mounting path vs other contexts"
  ],
  "_classification": {
    "category": "Can be dockerized without any issue",
    "timestamp": "2025-04-05 00:29:56"
  },
  "git_commit_info": {
    "sha": "1114ca1ab651707abaf5d7505d9d5144cc1bbd89",
    "date": "2015-03-14T10:52:47Z",
    "message": "tests: fix assert usage mistake\n\nfixes #2592",
    "author": "Phat"
  },
  "repository_info": {
    "structure_summary": ".\n./.git\n./.git/branches\n./.git/description\n./.git/hooks\n./.git/hooks/applypatch-msg.sample\n./.git/hooks/commit-msg.sample\n./.git/hooks/post-update.sample\n./.git/hooks/pre-applypatch.sample\n./.git/hooks/pre-commit.sample\n./.git/hooks/pre-merge-commit.sample\n./.git/hooks/pre-push.sample\n./.git/hooks/pre-receive.sample\n./.git/hooks/push-to-checkout.sample\n./.git/hooks/update.sample\n./.git/hooks/fsmonitor-watchman.sample\n./.git/hooks/pre-rebase.sample\n./.git/hooks/prepare-commit-msg.sample\n./.git/hooks/sendemail-validate.sample\n./.git/info\n./.git/info/exclude\n./.git/config\n./.git/objects\n./.git/objects/pack\n./.git/objects/pack/pack-effac9e0e557cdd86e0a81313c0575023448ce88.pack\n./.git/objects/pack/pack-effac9e0e557cdd86e0a81313c0575023448ce88.rev\n./.git/objects/pack/pack-effac9e0e557cdd86e0a81313c0575023448ce88.idx\n./.git/objects/info\n./.git/HEAD\n./.git/refs\n./.git/refs/heads\n./.git/refs/heads/master\n./.git/refs/tags\n./.git/refs/remotes\n./.git/refs/remotes/origin\n./.git/refs/remotes/origin/HEAD\n./.git/packed-refs\n./.git/logs\n./.git/logs/refs\n./.git/logs/refs/remotes\n./.git/logs/refs/remotes/origin\n./.git/logs/refs/remotes/origin/HEAD\n./.git/logs/refs/heads\n./.git/logs/refs/heads/master\n./.git/logs/HEAD\n./.git/index\n./LICENSE\n./benchmarks\n./benchmarks/Makefile\n./benchmarks/middleware.js\n./benchmarks/run\n./examples\n./examples/auth\n./examples/auth/views\n./examples/auth/views/foot.ejs\n./examples/auth/views/head.ejs\n./examples/auth/views/login.ejs\n./examples/auth/index.js\n./examples/auth/pass.js\n./examples/content-negotiation\n./examples/content-negotiation/db.js\n./examples/content-negotiation/index.js\n./examples/content-negotiation/users.js\n./examples/cookie-sessions\n./examples/cookie-sessions/index.js\n./examples/cookies\n./examples/cookies/index.js\n./examples/downloads\n./examples/downloads/files\n./examples/downloads/files/CCTV\u5927\u8d5b\u4e0a\u6d77\u5206\u8d5b\u533a.txt\n./examples/downloads/files/amazing.txt\n./examples/downloads/files/utf-8 \ud55c\u4e2d\u65e5.txt\n./examples/downloads/index.js\n./examples/ejs\n./examples/ejs/views\n./examples/ejs/views/footer.html\n./examples/ejs/views/header.html\n./examples/ejs/views/users.html\n./examples/ejs/index.js\n./examples/error-pages\n./examples/error-pages/views\n./examples/error-pages/views/footer.ejs\n./examples/error-pages/views/404.ejs\n./examples/error-pages/views/500.ejs\n./examples/error-pages/views/error_header.ejs\n./examples/error-pages/views/index.ejs\n./examples/error-pages/index.js\n./examples/error\n./examples/error/index.js\n./examples/hello-world\n./examples/hello-world/index.js\n./examples/markdown\n./examples/markdown/views\n./examples/markdown/views/index.md\n./examples/markdown/index.js\n./examples/multi-router\n./examples/multi-router/controllers\n./examples/multi-router/controllers/api_v1.js\n./examples/multi-router/controllers/api_v2.js\n./examples/multi-router/index.js\n./examples/mvc\n./examples/mvc/controllers\n./examples/mvc/controllers/main\n./examples/mvc/controllers/main/index.js\n./examples/mvc/controllers/pet\n./examples/mvc/controllers/pet/views\n./examples/mvc/controllers/pet/views/edit.ejs\n./examples/mvc/controllers/pet/views/show.ejs\n./examples/mvc/controllers/pet/index.js\n./examples/mvc/controllers/user-pet\n./examples/mvc/controllers/user-pet/index.js\n./examples/mvc/controllers/user\n./examples/mvc/controllers/user/index.js\n./examples/mvc/controllers/user/views\n./examples/mvc/controllers/user/views/edit.jade\n./examples/mvc/controllers/user/views/list.jade\n./examples/mvc/controllers/user/views/show.jade\n./examples/mvc/lib\n./examples/mvc/lib/boot.js\n./examples/mvc/public\n./examples/mvc/public/style.css\n./examples/mvc/db.js\n./examples/mvc/index.js\n./examples/mvc/views\n./examples/mvc/views/404.jade\n./examples/mvc/views/5xx.jade\n./examples/online\n./examples/online/index.js\n./examples/params\n./examples/params/index.js\n./examples/resource\n./examples/resource/index.js\n./examples/route-map\n./examples/route-map/index.js\n./examples/route-middleware\n./examples/route-middleware/index.js\n./examples/route-separation\n./examples/route-separation/public\n./examples/route-separation/public/style.css\n./examples/route-separation/index.js\n./examples/route-separation/post.js\n./examples/route-separation/site.js\n./examples/route-separation/user.js\n./examples/route-separation/views\n./examples/route-separation/views/index.jade\n./examples/route-separation/views/layout.jade\n./examples/route-separation/views/posts\n./examples/route-separation/views/posts/index.jade\n./examples/route-separation/views/users\n./examples/route-separation/views/users/edit.jade\n./examples/route-separation/views/users/index.jade\n./examples/route-separation/views/users/view.jade\n./examples/search\n./examples/search/client.js\n./examples/search/index.js\n./examples/search/search.jade\n./examples/session\n./examples/session/index.js\n./examples/session/redis.js\n./examples/static-files\n./examples/static-files/public\n./examples/static-files/public/css\n./examples/static-files/public/css/style.css\n./examples/static-files/public/hello.txt\n./examples/static-files/public/js\n./examples/static-files/public/js/app.js\n./examples/static-files/index.js\n./examples/vhost\n./examples/vhost/index.js\n./examples/view-constructor\n./examples/view-constructor/github-view.js\n./examples/view-constructor/index.js\n./examples/view-locals\n./examples/view-locals/index.js\n./examples/view-locals/layout.jade\n./examples/view-locals/user.jade\n./examples/view-locals/user.js\n./examples/web-service\n./examples/web-service/index.js\n./examples/big-view\n./examples/big-view/index.js\n./examples/big-view/pets.jade\n./examples/expose-data-to-client\n./examples/expose-data-to-client/index.js\n./examples/expose-data-to-client/views\n./examples/expose-data-to-client/views/page.jade\n./examples/jade\n./examples/jade/index.js\n./examples/jade/public\n./examples/jade/public/stylesheets\n./examples/jade/public/stylesheets/style.css\n./examples/jade/views\n./examples/jade/views/header.jade\n./examples/jade/views/layout.jade\n./examples/jade/views/users\n./examples/jade/views/users/index.jade\n./examples/jade/views/users/user.jade\n./examples/multipart\n./examples/multipart/index.js\n./lib\n./lib/application.js\n./lib/express.js\n./lib/middleware\n./lib/middleware/init.js\n./lib/middleware/query.js\n./lib/request.js\n./lib/response.js\n./lib/router\n./lib/router/index.js\n./lib/router/layer.js\n./lib/router/route.js\n./lib/utils.js\n./lib/view.js\n./test\n./test/acceptance\n./test/acceptance/content-negotiation.js\n./test/acceptance/ejs.js\n./test/acceptance/markdown.js\n./test/acceptance/resource.js\n./test/acceptance/route-separation.js\n./test/acceptance/vhost.js\n./test/acceptance/auth.js\n./test/acceptance/cookies.js\n./test/acceptance/downloads.js\n./test/acceptance/error-pages.js\n./test/acceptance/error.js\n./test/acceptance/multi-router.js\n./test/acceptance/mvc.js\n./test/acceptance/params.js\n./test/acceptance/route-map.js\n./test/acceptance/web-service.js\n./test/req.acceptsCharset.js\n./test/req.acceptsEncoding.js\n./test/req.acceptsLanguage.js\n./test/req.baseUrl.js\n./test/req.get.js\n./test/req.hostname.js\n./test/req.ips.js\n./test/utils.js\n./test/fixtures\n./test/fixtures/% of dogs.txt\n./test/fixtures/.name\n./test/fixtures/blog\n./test/fixtures/blog/index.html\n./test/fixtures/blog/post\n./test/fixtures/blog/post/index.tmpl\n./test/fixtures/default_layout\n./test/fixtures/default_layout/name.tmpl\n./test/fixtures/default_layout/user.tmpl\n./test/fixtures/email.tmpl\n./test/fixtures/local_layout\n./test/fixtures/local_layout/user.tmpl\n./test/fixtures/name.tmpl\n./test/fixtures/name.txt\n./test/fixtures/user.html\n./test/fixtures/user.tmpl\n./test/req.param.js\n./test/req.path.js\n./test/req.protocol.js\n./test/req.query.js\n./test/req.range.js\n./test/req.route.js\n./test/req.secure.js\n./test/req.signedCookies.js\n./test/req.stale.js\n./test/req.subdomains.js\n./test/req.xhr.js\n./test/res.append.js\n./test/res.attachment.js\n./test/res.clearCookie.js\n./test/res.cookie.js\n./test/res.download.js\n./test/res.format.js\n./test/res.get.js\n./test/res.json.js\n./test/res.jsonp.js\n./test/res.links.js\n./test/res.locals.js\n./test/res.location.js\n./test/res.redirect.js\n./test/res.render.js\n./test/res.send.js\n./test/res.sendFile.js\n./test/res.sendStatus.js\n./test/res.set.js\n./test/res.status.js\n./test/res.type.js\n./test/res.vary.js\n./test/support\n./test/support/env.js\n./test/support/tmpl.js\n./test/Route.js\n./test/Router.js\n./test/app.all.js\n./test/app.del.js\n./test/app.engine.js\n./test/app.head.js\n./test/app.js\n./test/app.listen.js\n./test/app.locals.js\n./test/app.options.js\n./test/app.param.js\n./test/app.render.js\n./test/app.request.js\n./test/app.response.js\n./test/app.route.js\n./test/app.router.js\n./test/app.routes.error.js\n./test/app.use.js\n./test/config.js\n./test/exports.js\n./test/middleware.basic.js\n./test/mocha.opts\n./test/regression.js\n./test/req.accepts.js\n./test/req.acceptsCharsets.js\n./test/req.acceptsEncodings.js\n./test/req.acceptsLanguages.js\n./test/req.fresh.js\n./test/req.host.js\n./test/req.ip.js\n./test/req.is.js\n./.gitignore\n./.travis.yml\n./Contributing.md\n./History.md\n./Readme.md\n./appveyor.yml\n./index.js\n./package.json\n",
    "readme": "\n--- ./Readme.md ---\n[![Express Logo](https://i.cloudup.com/zfY6lL7eFa-3000x3000.png)](http://expressjs.com/)\n\n  Fast, unopinionated, minimalist web framework for [node](http://nodejs.org).\n\n  [![NPM Version][npm-image]][npm-url]\n  [![NPM Downloads][downloads-image]][downloads-url]\n  [![Linux Build][travis-image]][travis-url]\n  [![Windows Build][appveyor-image]][appveyor-url]\n  [![Test Coverage][coveralls-image]][coveralls-url]\n\n```js\nvar express = require('express')\nvar app = express()\n\napp.get('/', function (req, res) {\n  res.send('Hello World')\n})\n\napp.listen(3000)\n```\n\n## Installation\n\n```bash\n$ npm install express\n```\n\n## Features\n\n  * Robust routing\n  * Focus on high performance\n  * Super-high test coverage\n  * HTTP helpers (redirection, caching, etc)\n  * View system supporting 14+ template engines\n  * Content negotiation\n  * Executable for generating applications quickly\n\n## Docs & Community\n\n  * [Website and Documentation](http://expressjs.com/) - [[website repo](https://github.com/strongloop/expressjs.com)]\n  * [#express](https://webchat.freenode.net/?channels=express) on freenode IRC\n  * [Github Organization](https://github.com/expressjs) for Official Middleware & Modules\n  * Visit the [Wiki](https://github.com/strongloop/express/wiki)\n  * [Google Group](https://groups.google.com/group/express-js) for discussion\n  * [\u0420\u0443\u0441\u0441\u043a\u043e\u044f\u0437\u044b\u0447\u043d\u0430\u044f \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f](http://jsman.ru/express/)\n  * [\ud55c\uad6d\uc5b4 \ubb38\uc11c](http://expressjs.kr) - [[website repo](https://github.com/Hanul/expressjs.kr)]\n\n**PROTIP** Be sure to read [Migrating from 3.x to 4.x](https://github.com/strongloop/express/wiki/Migrating-from-3.x-to-4.x) as well as [New features in 4.x](https://github.com/strongloop/express/wiki/New-features-in-4.x).\n\n## Quick Start\n\n  The quickest way to get started with express is to utilize the executable [`express(1)`](https://github.com/expressjs/generator) to generate an application as shown below:\n\n  Install the executable. The executable's major version will match Express's:\n\n```bash\n$ npm install -g express-generator@4\n```\n\n  Create the app:\n\n```bash\n$ express /tmp/foo && cd /tmp/foo\n```\n\n  Install dependencies:\n\n```bash\n$ npm install\n```\n\n  Start the server:\n\n```bash\n$ npm start\n```\n\n## Philosophy\n\n  The Express philosophy is to provide small, robust tooling for HTTP servers, making\n  it a great solution for single page applications, web sites, hybrids, or public\n  HTTP APIs.\n\n  Express does not force you to use any specific ORM or template engine. With support for over\n  14 template engines via [Consolidate.js](https://github.com/tj/consolidate.js),\n  you can quickly craft your perfect framework.\n\n## Examples\n\n  To view the examples, clone the Express repo and install the dependancies:\n\n```bash\n$ git clone git://github.com/strongloop/express.git --depth 1\n$ cd express\n$ npm install\n```\n\n  Then run whichever example you want:\n\n```bash\n$ node examples/content-negotiation\n```\n\n## Tests\n\n  To run the test suite, first install the dependencies, then run `npm test`:\n\n```bash\n$ npm install\n$ npm test\n```\n\n## People\n\nThe original author of Express is [TJ Holowaychuk](https://github.com/tj) [![TJ's Gratipay][gratipay-image-visionmedia]][gratipay-url-visionmedia]\n\nThe current lead maintainer is [Douglas Christopher Wilson](https://github.com/dougwilson) [![Doug's Gratipay][gratipay-image-dougwilson]][gratipay-url-dougwilson]\n\n[List of all contributors](https://github.com/strongloop/express/graphs/contributors)\n\n## License\n\n  [MIT](LICENSE)\n\n[npm-image]: https://img.shields.io/npm/v/express.svg\n[npm-url]: https://npmjs.org/package/express\n[downloads-image]: https://img.shields.io/npm/dm/express.svg\n[downloads-url]: https://npmjs.org/package/express\n[travis-image]: https://img.shields.io/travis/strongloop/express/master.svg?label=linux\n[travis-url]: https://travis-ci.org/strongloop/express\n[appveyor-image]: https://img.shields.io/appveyor/ci/dougwilson/express/master.svg?label=windows\n[appveyor-url]: https://ci.appveyor.com/project/dougwilson/express\n[coveralls-image]: https://img.shields.io/coveralls/strongloop/express/master.svg\n[coveralls-url]: https://coveralls.io/r/strongloop/express?branch=master\n[gratipay-image-visionmedia]: https://img.shields.io/gratipay/visionmedia.svg\n[gratipay-url-visionmedia]: https://gratipay.com/visionmedia/\n[gratipay-image-dougwilson]: https://img.shields.io/gratipay/dougwilson.svg\n[gratipay-url-dougwilson]: https://gratipay.com/dougwilson/\n\n\n\n--- ./examples/markdown/views/index.md ---\n\n# {title}\n\nJust an example view rendered with _markdown_.\n\n\n--- ./Contributing.md ---\n\n## Website Issues\n\nIssues for the expressjs.com website go here https://github.com/strongloop/expressjs.com\n\n## PRs and Code contributions\n\n* Tests must pass.\n* Follow existing coding style.\n* If you fix a bug, add a test.\n\n\n## Issues which are questions\n\nWe will typically close any vague issues or questions that are specific to some app you are writing. Please double check the docs and other references before being trigger happy with posting a question issue.\n\nThings that will help get your question issue looked at:\n\n* Full and runnable JS code.\n* Clear description of the problem or unexpected behavior.\n* Clear description of the expected result.\n* Steps you have taken to debug it yourself.\n\nIf you post a question and do not outline the above items or make it easy for us to understand and reproduce your issue, it will be closed.\n\n\n\n",
    "readme_filenames": [
      "./Readme.md",
      "./examples/markdown/views/index.md",
      "./Contributing.md"
    ]
  },
  "llm_calls_before_build": 25,
  "dockerfile_attempt_1": 1,
  "dockerfile": "FROM node:14-alpine\n# Set working directory for the application\nWORKDIR /app\n\n# Install git required for cloning repository\nRUN apk add --no-cache git\n\n# Clone express repository\nRUN git clone https://github.com/expressjs/express.git\n\n# Checkout specific commit from the issue\nWORKDIR /app/express\nRUN git checkout 1114ca1ab651707abaf5d7505d9d5144cc1bbd89\n\n# Install project dependencies as per standard Express setup\nRUN npm install\n\n# Build the project (express doesn't require traditional build but installs dependencies)\n# Environment is now ready with express@1114ca1 and dependencies for validation",
  "dockerfile_build_success": true,
  "successful_candidate_index": 1,
  "successful_candidate_attempt": 1,
  "successful_candidate_improvement_attempt": 0,
  "llm_calls_total": 30
}