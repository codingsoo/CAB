{
  "number": 4762,
  "title": "ch complains \"Password required for user default., e.what() = DB::Exception.\" when drop a partition .But actually it has the user. And when try many times it will succeed",
  "created_at": "2019-03-22T08:58:55Z",
  "closed_at": "2019-03-22T10:12:13Z",
  "labels": [
    "question",
    "comp-dddl"
  ],
  "url": "https://github.com/ClickHouse/ClickHouse/issues/4762",
  "body": "**Version of ch:**\r\n\r\n> ckadsmodel-d724d9d7-9dc5-4694-b6ad-a7ad7883ca65 :) select version()\r\n\r\nSELECT version()\r\n\r\n\u250c\u2500version()\u2500\u2510\r\n\u2502 18.14.19  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\r\n**Cluster Config:**\r\n\r\n> SELECT * FROM system.clusters \r\n\r\n\u250c\u2500cluster\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500shard_num\u2500\u252c\u2500shard_weight\u2500\u252c\u2500replica_num\u2500\u252c\u2500host_name\u2500\u2500\u2500\u2500\u2500\u252c\u2500host_address\u2500\u2500\u252c\u2500port\u2500\u252c\u2500is_local\u2500\u252c\u2500user\u2500\u2500\u2500\u2500\u252c\u2500default_database\u2500\u2510\r\n\u2502 ads_model_ck_cluster \u2502         1 \u2502            1 \u2502           1 \u2502 xx.xx.30.65  \u2502 xx.xx.30.65  \u2502 9000 \u2502        1 \u2502 default \u2502                  \u2502\r\n\u2502 ads_model_ck_cluster \u2502         1 \u2502            1 \u2502           2 \u2502 xx.xx.40.123 \u2502 xx.xx.40.123 \u2502 9000 \u2502        1 \u2502 default \u2502                  \u2502\r\n\u2502 ads_model_ck_cluster \u2502         2 \u2502            1 \u2502           1 \u2502 xx.xx.30.64  \u2502 xx.xx.30.64  \u2502 9000 \u2502        0 \u2502 default \u2502                  \u2502\r\n\u2502 ads_model_ck_cluster \u2502         2 \u2502            1 \u2502           2 \u2502 xx.xx.30.69  \u2502 xx.xx.30.69  \u2502 9000 \u2502              0 \u2502 default \u2502                  \u2502\r\n....\r\n\u2502 ads_model_ck_cluster \u2502        15 \u2502            1 \u2502           1 \u2502 xx.xx.30.86  \u2502 xx.xx.30.86  \u2502 9000 \u2502        0 \u2502 default \u2502                  \u2502\r\n\u2502 ads_model_ck_cluster \u2502        15 \u2502            1 \u2502           2 \u2502 xx.xx.30.83  \u2502 xx.xx.30.83  \u2502 9000 \u2502        0 \u2502 default \u2502                  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n**Then Create test ReplicatedMergeTree loal table and Distribute table** \r\n\r\n> CREATE TABLE default.test1 on cluster ads_model_ck_cluster ( id UInt64,  name String, d Date) ENGINE =ReplicatedMergeTree('/clickhouse/tables/{layer}-{shard}/default/test1', '{replica}') PARTITION BY toMonday(d) ORDER BY (id, d) SETTINGS index_granularity = 8192;\r\n\r\n> CREATE TABLE default.test1_all on cluster ads_model_ck_cluster (id UInt64,  name String, d Date) ENGINE = Distributed('ads_model_ck_cluster', 'test', 'test1', rand());\r\n\r\nINSERT some volume data into the table \r\n> ckadsmodel-d724d9d7-9dc5-4694-b6ad-a7ad7883ca65 :)  select count() from test1_all;\r\n\r\nSELECT count()\r\nFROM test1_all \r\n\r\n\u250c\u2500count()\u2500\u2510\r\n\u2502 4390912 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n**Get Detailed info of the partitions:**\r\n\r\n> ckadsmodel-d724d9d7-9dc5-4694-b6ad-a7ad7883ca65 :) select database,table,partition_id,partition,name,active,rows,path,modification_time from system.parts where table='test1';\r\n\r\nSELECT \r\n    database, \r\n    table, \r\n    partition_id, \r\n    partition, \r\n    name, \r\n    active, \r\n    rows, \r\n    path, \r\n    modification_time\r\nFROM system.parts \r\nWHERE table = 'test1'\r\n\r\n\u250c\u2500database\u2500\u252c\u2500table\u2500\u252c\u2500partition_id\u2500\u252c\u2500partition\u2500\u2500\u2500\u2500\u252c\u2500name\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500active\u2500\u252c\u2500\u2500\u2500rows\u2500\u252c\u2500path\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500modification_time\u2500\u2510\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_25_25_0 \u2502      0 \u2502      1 \u2502 /export/data/clickhouse/data/default/test1/20190318_25_25_0/ \u2502 2019-03-22 16:05:07 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_25_30_1 \u2502      0 \u2502    123 \u2502 /export/data/clickhouse/data/default/test1/20190318_25_30_1/ \u2502 2019-03-22 16:05:14 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_25_35_2 \u2502      0 \u2502   4642 \u2502 /export/data/clickhouse/data/default/test1/20190318_25_35_2/ \u2502 2019-03-22 16:05:17 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_25_40_3 \u2502      0 \u2502 146165 \u2502 /export/data/clickhouse/data/default/test1/20190318_25_40_3/ \u2502 2019-03-22 16:06:00 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_25_43_4 \u2502      1 \u2502 290307 \u2502 /export/data/clickhouse/data/default/test1/20190318_25_43_4/ \u2502 2019-03-22 16:07:17 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_26_26_0 \u2502      0 \u2502      8 \u2502 /export/data/clickhouse/data/default/test1/20190318_26_26_0/ \u2502 2019-03-22 16:05:11 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_27_27_0 \u2502      0 \u2502     11 \u2502 /export/data/clickhouse/data/default/test1/20190318_27_27_0/ \u2502 2019-03-22 16:05:11 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_28_28_0 \u2502      0 \u2502     17 \u2502 /export/data/clickhouse/data/default/test1/20190318_28_28_0/ \u2502 2019-03-22 16:05:12 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_29_29_0 \u2502      0 \u2502     26 \u2502 /export/data/clickhouse/data/default/test1/20190318_29_29_0/ \u2502 2019-03-22 16:05:13 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_30_30_0 \u2502      0 \u2502     60 \u2502 /export/data/clickhouse/data/default/test1/20190318_30_30_0/ \u2502 2019-03-22 16:05:13 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_31_31_0 \u2502      0 \u2502    142 \u2502 /export/data/clickhouse/data/default/test1/20190318_31_31_0/ \u2502 2019-03-22 16:05:14 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_32_32_0 \u2502      0 \u2502    305 \u2502 /export/data/clickhouse/data/default/test1/20190318_32_32_0/ \u2502 2019-03-22 16:05:15 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_33_33_0 \u2502      0 \u2502    553 \u2502 /export/data/clickhouse/data/default/test1/20190318_33_33_0/ \u2502 2019-03-22 16:05:15 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_34_34_0 \u2502      0 \u2502   1182 \u2502 /export/data/clickhouse/data/default/test1/20190318_34_34_0/ \u2502 2019-03-22 16:05:16 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_35_35_0 \u2502      0 \u2502   2337 \u2502 /export/data/clickhouse/data/default/test1/20190318_35_35_0/ \u2502 2019-03-22 16:05:17 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_36_36_0 \u2502      0 \u2502   4585 \u2502 /export/data/clickhouse/data/default/test1/20190318_36_36_0/ \u2502 2019-03-22 16:05:17 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_37_37_0 \u2502      0 \u2502   9213 \u2502 /export/data/clickhouse/data/default/test1/20190318_37_37_0/ \u2502 2019-03-22 16:05:34 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_38_38_0 \u2502      0 \u2502  18316 \u2502 /export/data/clickhouse/data/default/test1/20190318_38_38_0/ \u2502 2019-03-22 16:05:55 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_39_39_0 \u2502      0 \u2502  36600 \u2502 /export/data/clickhouse/data/default/test1/20190318_39_39_0/ \u2502 2019-03-22 16:05:58 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_40_40_0 \u2502      0 \u2502  72809 \u2502 /export/data/clickhouse/data/default/test1/20190318_40_40_0/ \u2502 2019-03-22 16:06:00 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_41_41_0 \u2502      0 \u2502    501 \u2502 /export/data/clickhouse/data/default/test1/20190318_41_41_0/ \u2502 2019-03-22 16:06:00 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_42_42_0 \u2502      0 \u2502  72817 \u2502 /export/data/clickhouse/data/default/test1/20190318_42_42_0/ \u2502 2019-03-22 16:06:02 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_43_43_0 \u2502      0 \u2502  70824 \u2502 /export/data/clickhouse/data/default/test1/20190318_43_43_0/ \u2502 2019-03-22 16:06:02 \u2502\r\n\u2502 default  \u2502 test1 \u2502 20190318     \u2502 '2019-03-18' \u2502 20190318_44_44_0 \u2502      1 \u2502   3065 \u2502 /export/data/clickhouse/data/default/test1/20190318_44_44_0/ \u2502 2019-03-22 16:06:02 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\r\n**Try to delete one partition using alter table** \r\n\r\n> ckadsmodel-d724d9d7-9dc5-4694-b6ad-a7ad7883ca65 :) alter table default.test1 on cluster ads_model_ck_cluster drop partition '2019-03-18';\r\n\r\nALTER TABLE default.test1 ON CLUSTER ads_model_ck_cluster\r\n    DROP PARTITION '2019-03-18'\r\n\r\n\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.30.66  \u2502 9000 \u2502      0 \u2502                                                                                                                                                           \u2502                  29 \u2502               18 \u2502\r\n\u2502 xx.xx.30.69  \u2502 9000 \u2502      0 \u2502                                                                                                                                                           \u2502                  28 \u2502               18 \u2502\r\n\u2502 xx.xx.30.70  \u2502 9000 \u2502      0 \u2502                                                                                                                                                           \u2502                  27 \u2502               18 \u2502\r\n\u2502 xx.xx.30.76  \u2502 9000 \u2502      0 \u2502                                                                                                                                                           \u2502                  26 \u2502               18 \u2502\r\n\u2502 xx.xx.30.71  \u2502 9000 \u2502      0 \u2502                                                                                                                                                           \u2502                  25 \u2502               18 \u2502\r\n\u2502 xx.xx.30.79  \u2502 9000 \u2502    194 \u2502 Code: 194, e.displayText() = DB::Exception: Received from xx.xx.30.82:9000. DB::Exception: Password required for user default., e.what() = DB::Exception \u2502                  24 \u2502               18 \u2502\r\n\u2502 xx.xx.217.46 \u2502 9000 \u2502      0 \u2502                                                                                                                                                           \u2502                  23 \u2502               18 \u2502\r\n\u2502 xx.xx.30.86  \u2502 9000 \u2502      0 \u2502                                                                                                                                                           \u2502                  22 \u2502               18 \u2502\r\n\u2502 xx.xx.30.65  \u2502 9000 \u2502      0 \u2502                                                                                                                                                           \u2502                  21 \u2502               18 \u2502\r\n\u2502 xx.xx.40.123 \u2502 9000 \u2502      0 \u2502                                                                                                                                                           \u2502                  20 \u2502               18 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.30.72  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  19 \u2502               12 \u2502\r\n\u2502 xx.xx.30.67  \u2502 9000 \u2502    194 \u2502 Code: 194, e.displayText() = DB::Exception: Received from xx.xx.30.68:9000. DB::Exception: Password required for user default., e.what() = DB::Exception  \u2502                  18 \u2502               12 \u2502\r\n\u2502 xx.xx.217.49 \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  17 \u2502               12 \u2502\r\n\u2502 xx.xx.30.81  \u2502 9000 \u2502    194 \u2502 Code: 194, e.displayText() = DB::Exception: Received from xx.xx.217.52:9000. DB::Exception: Password required for user default., e.what() = DB::Exception \u2502                  16 \u2502               12 \u2502\r\n\u2502 xx.xx.217.47 \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  15 \u2502               12 \u2502\r\n\u2502 xx.xx.30.74  \u2502 9000 \u2502    194 \u2502 Code: 194, e.displayText() = DB::Exception: Received from xx.xx.30.78:9000. DB::Exception: Password required for user default., e.what() = DB::Exception  \u2502                  14 \u2502               12 \u2502\r\n\u2502 xx.xx.30.85  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  13 \u2502               12 \u2502\r\n\u2502 xx.xx.30.77  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  12 \u2502               12 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.30.78  \u2502 9000 \u2502      0 \u2502       \u2502                  11 \u2502                9 \u2502\r\n\u2502 xx.xx.30.73  \u2502 9000 \u2502      0 \u2502       \u2502                  10 \u2502                9 \u2502\r\n\u2502 xx.xx.217.45 \u2502 9000 \u2502      0 \u2502       \u2502                   9 \u2502                9 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.217.50 \u2502 9000 \u2502      0 \u2502       \u2502                   8 \u2502                8 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.217.52 \u2502 9000 \u2502      0 \u2502       \u2502                   7 \u2502                7 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.30.82 \u2502 9000 \u2502      0 \u2502       \u2502                   6 \u2502                6 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.30.68  \u2502 9000 \u2502      0 \u2502       \u2502                   5 \u2502                3 \u2502\r\n\u2502 xx.xx.40.126 \u2502 9000 \u2502      0 \u2502       \u2502                   4 \u2502                3 \u2502\r\n\u2502 xx.xx.30.64  \u2502 9000 \u2502      0 \u2502       \u2502                   3 \u2502                3 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.217.48 \u2502 9000 \u2502      0 \u2502       \u2502                   2 \u2502                0 \u2502\r\n\u2502 xx.xx.30.80  \u2502 9000 \u2502      0 \u2502       \u2502                   1 \u2502                0 \u2502\r\n\u2502 xx.xx.30.83  \u2502 9000 \u2502      0 \u2502       \u2502                   0 \u2502                0 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nReceived exception from server (version 18.14.19):\r\nCode: 194. DB::Exception: Received from 127.0.0.1:9000. DB::Exception: There was an error on [xx.xx.30.79:9000]: Code: 194, e.displayText() = DB::Exception: Received from xx.xx.30.82:9000. DB::Exception: Password required for user default., e.what() = DB::Exception. \r\n\r\n30 rows in set. Elapsed: 1.072 sec. \r\n\r\n**Still some node has data** \r\nxx.xx.30.68 \r\n291660\r\nxx.xx.30.67 \r\n291660\r\nxx.xx.30.78 \r\n291577\r\nxx.xx.30.74 \r\n291577\r\nxx.xx.30.79 \r\n293352\r\nxx.xx.30.82 \r\n293352\r\nxx.xx.30.81 \r\n293279\r\nxx.xx.217.52 \r\n293279\r\n\r\n**Then I try it for the third Time** \r\nckadsmodel-d724d9d7-9dc5-4694-b6ad-a7ad7883ca65 :) alter table default.test1 on cluster ads_model_ck_cluster drop partition '2019-03-18';\r\n\r\nALTER TABLE default.test1 ON CLUSTER ads_model_ck_cluster\r\n    DROP PARTITION '2019-03-18'\r\n\r\n\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.30.78  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  29 \u2502               15 \u2502\r\n\u2502 xx.xx.30.67  \u2502 9000 \u2502    194 \u2502 Code: 194, e.displayText() = DB::Exception: Received from xx.xx.30.68:9000. DB::Exception: Password required for user default., e.what() = DB::Exception  \u2502                  28 \u2502               15 \u2502\r\n\u2502 xx.xx.30.72  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  27 \u2502               15 \u2502\r\n\u2502 xx.xx.30.81  \u2502 9000 \u2502    194 \u2502 Code: 194, e.displayText() = DB::Exception: Received from xx.xx.217.52:9000. DB::Exception: Password required for user default., e.what() = DB::Exception \u2502                  26 \u2502               15 \u2502\r\n\u2502 xx.xx.30.65  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  25 \u2502               15 \u2502\r\n\u2502 xx.xx.30.86  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  24 \u2502               15 \u2502\r\n\u2502 xx.xx.217.47 \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  23 \u2502               15 \u2502\r\n\u2502 xx.xx.30.66  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  22 \u2502               15 \u2502\r\n\u2502 xx.xx.30.69  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  21 \u2502               15 \u2502\r\n\u2502 xx.xx.30.70  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  20 \u2502               15 \u2502\r\n\u2502 xx.xx.30.76  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  19 \u2502               15 \u2502\r\n\u2502 xx.xx.30.71  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  18 \u2502               15 \u2502\r\n\u2502 xx.xx.30.85  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  17 \u2502               15 \u2502\r\n\u2502 xx.xx.30.82  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  16 \u2502               15 \u2502\r\n\u2502 xx.xx.30.77  \u2502 9000 \u2502      0 \u2502                                                                                                                                                            \u2502                  15 \u2502               15 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.217.45 \u2502 9000 \u2502      0 \u2502       \u2502                  14 \u2502               12 \u2502\r\n\u2502 xx.xx.217.46 \u2502 9000 \u2502      0 \u2502       \u2502                  13 \u2502               12 \u2502\r\n\u2502 xx.xx.40.123 \u2502 9000 \u2502      0 \u2502       \u2502                  12 \u2502               12 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.217.52 \u2502 9000 \u2502      0 \u2502       \u2502                  11 \u2502               11 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.217.50 \u2502 9000 \u2502      0 \u2502       \u2502                  10 \u2502                6 \u2502\r\n\u2502 xx.xx.30.73  \u2502 9000 \u2502      0 \u2502       \u2502                   9 \u2502                6 \u2502\r\n\u2502 xx.xx.40.126 \u2502 9000 \u2502      0 \u2502       \u2502                   8 \u2502                6 \u2502\r\n\u2502 xx.xx.217.48 \u2502 9000 \u2502      0 \u2502       \u2502                   7 \u2502                6 \u2502\r\n\u2502 xx.xx.30.79  \u2502 9000 \u2502      0 \u2502       \u2502                   6 \u2502                6 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.30.68  \u2502 9000 \u2502      0 \u2502       \u2502                   5 \u2502                4 \u2502\r\n\u2502 xx.xx.217.49 \u2502 9000 \u2502      0 \u2502       \u2502                   4 \u2502                4 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.30.64 \u2502 9000 \u2502      0 \u2502       \u2502                   3 \u2502                2 \u2502\r\n\u2502 xx.xx.30.74 \u2502 9000 \u2502      0 \u2502       \u2502                   2 \u2502                2 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n\u250c\u2500host\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500port\u2500\u252c\u2500status\u2500\u252c\u2500error\u2500\u252c\u2500num_hosts_remaining\u2500\u252c\u2500num_hosts_active\u2500\u2510\r\n\u2502 xx.xx.30.80 \u2502 9000 \u2502      0 \u2502       \u2502                   1 \u2502                0 \u2502\r\n\u2502 xx.xx.30.83 \u2502 9000 \u2502      0 \u2502       \u2502                   0 \u2502                0 \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\nReceived exception from server (version 18.14.19):\r\nCode: 194. DB::Exception: Received from 127.0.0.1:9000. DB::Exception: There was an error on [xx.xx.30.67:9000]: Code: 194, e.displayText() = DB::Exception: Received from xx.xx.30.68:9000. DB::Exception: Password required for user default., e.what() = DB::Exception. \r\n\r\n30 rows in set. Elapsed: 1.071 sec. \r\n\r\n**Although there are errors warning, the data is deleted successfully.**\r\nThis is very strange. Can anyone give a hint on this?  \r\n",
  "comments_url": "https://api.github.com/repos/ClickHouse/ClickHouse/issues/4762/comments",
  "author": "inolddays",
  "comments": [
    {
      "user": "filimonov",
      "created_at": "2019-03-22T09:49:05Z",
      "body": "Duplicate of #1861 \r\n\r\nPR #3598 fixes that (should work properly in versions > 19.1)\r\n\r\nGenerally, when you do some DDL on non-leader replica it forwards the request to a leader, and during that forwarding \"default\" passwordless user was used. "
    }
  ],
  "git_commit_info": {
    "sha": "045fd6f55db37059c97c0c276e8914b096e1f6bb",
    "date": "2017-02-07T22:40:08Z",
    "message": "fix build without readline",
    "author": "proller"
  },
  "repository_info": {},
  "llm_calls_before_build": 0,
  "dockerfile_attempt_1": 1,
  "dockerfile_attempt_1_failed": true,
  "dockerfile_build_success": true,
  "llm_calls_total": 40,
  "dockerfile": "FROM ubuntu:20.04\n\n# Avoid interactive prompts during package installation\nENV DEBIAN_FRONTEND=noninteractive\n\n# Install dependencies for ClickHouse build\nRUN apt-get update && apt-get install -y \\\n    apt-transport-https \\\n    ca-certificates \\\n    dirmngr \\\n    gnupg \\\n    wget \\\n    sudo \\\n    git \\\n    cmake \\\n    build-essential \\\n    gcc-9 \\\n    g++-9 \\\n    libicu-dev \\\n    libreadline-dev \\\n    libmysqlclient-dev \\\n    unixodbc-dev \\\n    libltdl-dev \\\n    libssl-dev \\\n    libgoogle-perftools-dev \\\n    libbz2-dev \\\n    libzstd-dev \\\n    libboost-dev \\\n    libboost-system-dev \\\n    libboost-filesystem-dev \\\n    libboost-thread-dev \\\n    libboost-program-options-dev \\\n    zlib1g-dev \\\n    liblz4-dev \\\n    libdouble-conversion-dev \\\n    libzookeeper-mt-dev \\\n    libsparsehash-dev \\\n    librdkafka-dev \\\n    libcapnp-dev \\\n    libpoco-dev \\\n    libunwind-dev \\\n    libxml2-dev \\\n    libpcre3-dev \\\n    ninja-build \\\n    python3 \\\n    python3-pip \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Set gcc-9 as default compiler\nRUN update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 90 \\\n    && update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 90 \\\n    && update-alternatives --set gcc /usr/bin/gcc-9 \\\n    && update-alternatives --set g++ /usr/bin/g++-9\n\n# Create build directory\nWORKDIR /build\n\n# Clone ClickHouse repository and checkout specific commit\nRUN git clone https://github.com/ClickHouse/ClickHouse.git \\\n    && cd ClickHouse \\\n    && git checkout 045fd6f55db37059c97c0c276e8914b096e1f6bb\n\n# Create build directory\nWORKDIR /build/ClickHouse/build\n\n# Configure cmake for the build\nRUN cmake .. -DCMAKE_BUILD_TYPE=Release\n\n# Build ClickHouse (with retry mechanism to handle potential build failures)\nRUN for i in 1 2 3; do \\\n        cmake --build . -- -j$(nproc) && break || \\\n        echo \"Build attempt $i failed, retrying with less parallelism...\" && \\\n        cmake --build . -- -j2 && break || \\\n        echo \"Build attempt $i failed, retrying with single thread...\" && \\\n        cmake --build . -- -j1 && break || \\\n        echo \"Build attempt $i failed, will retry...\" && \\\n        sleep 5; \\\n    done\n\n# Add the build directory to PATH\nENV PATH=\"/build/ClickHouse/build/programs:${PATH}\"\n\n# Create directories for ClickHouse data and configuration\nRUN mkdir -p /etc/clickhouse-server/config.d \\\n    && mkdir -p /etc/clickhouse-server/users.d \\\n    && mkdir -p /var/lib/clickhouse \\\n    && mkdir -p /var/log/clickhouse-server\n\n# Create a basic configuration file for ClickHouse server\nRUN echo '<clickhouse>\\n\\\n    <logger>\\n\\\n        <level>trace</level>\\n\\\n        <console>true</console>\\n\\\n        <log>/var/log/clickhouse-server/clickhouse-server.log</log>\\n\\\n        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>\\n\\\n    </logger>\\n\\\n    <listen_host>0.0.0.0</listen_host>\\n\\\n    <listen_try>1</listen_try>\\n\\\n    <path>/var/lib/clickhouse/</path>\\n\\\n    <tmp_path>/var/lib/clickhouse/tmp/</tmp_path>\\n\\\n    <format_schema_path>/var/lib/clickhouse/format_schemas/</format_schema_path>\\n\\\n</clickhouse>' > /etc/clickhouse-server/config.xml\n\n# Create a users.xml file with default settings (no password for default user)\nRUN echo '<clickhouse>\\n\\\n    <users>\\n\\\n        <default>\\n\\\n            <password></password>\\n\\\n            <networks>\\n\\\n                <ip>::/0</ip>\\n\\\n            </networks>\\n\\\n            <profile>default</profile>\\n\\\n            <quota>default</quota>\\n\\\n        </default>\\n\\\n    </users>\\n\\\n    <profiles>\\n\\\n        <default>\\n\\\n        </default>\\n\\\n    </profiles>\\n\\\n    <quotas>\\n\\\n        <default>\\n\\\n        </default>\\n\\\n    </quotas>\\n\\\n</clickhouse>' > /etc/clickhouse-server/users.xml\n\n# Create a cluster configuration for testing\nRUN echo '<clickhouse>\\n\\\n    <remote_servers>\\n\\\n        <test_cluster>\\n\\\n            <shard>\\n\\\n                <replica>\\n\\\n                    <host>localhost</host>\\n\\\n                    <port>9000</port>\\n\\\n                    <user>default</user>\\n\\\n                    <password></password>\\n\\\n                </replica>\\n\\\n            </shard>\\n\\\n        </test_cluster>\\n\\\n    </remote_servers>\\n\\\n</clickhouse>' > /etc/clickhouse-server/config.d/remote_servers.xml\n\n# Create a test script to validate the issue fix\nRUN echo '#!/bin/bash\\n\\\n# Start ClickHouse server\\n\\\nclickhouse-server --config-file=/etc/clickhouse-server/config.xml &\\n\\\nsleep 5\\n\\\n\\n\\\n# Create test ReplicatedMergeTree table\\n\\\nclickhouse-client --query=\"CREATE TABLE test1 (\\n\\\n    id UInt32,\\n\\\n    date Date,\\n\\\n    value String\\n\\\n) ENGINE = ReplicatedMergeTree(\\\"/clickhouse/tables/test1\\\", \\\"{replica}\\\") \\n\\\nPARTITION BY toYYYYMM(date)\\n\\\nORDER BY id\"\\n\\\n\\n\\\n# Create Distributed table\\n\\\nclickhouse-client --query=\"CREATE TABLE test1_all AS test1 \\n\\\nENGINE = Distributed(test_cluster, default, test1, rand())\"\\n\\\n\\n\\\n# Insert test data with different partitions\\n\\\nclickhouse-client --query=\"INSERT INTO test1 VALUES (1, \\\"2022-01-01\\\", \\\"value1\\\")\"\\n\\\nclickhouse-client --query=\"INSERT INTO test1 VALUES (2, \\\"2022-02-01\\\", \\\"value2\\\")\"\\n\\\nclickhouse-client --query=\"INSERT INTO test1 VALUES (3, \\\"2022-03-01\\\", \\\"value3\\\")\"\\n\\\n\\n\\\n# Show partitions\\n\\\necho \"Current partitions:\"\\n\\\nclickhouse-client --query=\"SELECT partition, name FROM system.parts WHERE table=\\\"test1\\\" AND active=1\"\\n\\\n\\n\\\n# Try to drop partition multiple times to reproduce the issue\\n\\\necho \"Trying to drop partition 202201:\"\\n\\\nfor i in {1..5}; do\\n\\\n    clickhouse-client --query=\"ALTER TABLE test1 DROP PARTITION 202201\" || echo \"Failed attempt $i\"\\n\\\n    sleep 1\\n\\\ndone\\n\\\n\\n\\\n# Verify partition is dropped\\n\\\necho \"Remaining partitions:\"\\n\\\nclickhouse-client --query=\"SELECT partition, name FROM system.parts WHERE table=\\\"test1\\\" AND active=1\"\\n\\\n\\n\\\necho \"Test completed.\"\\n\\\n' > /test-issue-4762.sh\n\n# Make the test script executable\nRUN chmod +x /test-issue-4762.sh\n\n# Set working directory\nWORKDIR /\n\n# Default command\nCMD [\"echo\", \"ClickHouse environment prepared for testing issue #4762. Run /test-issue-4762.sh to validate the fix.\"]",
  "satisfaction_conditions": [
    "DDL operations must complete successfully across all cluster nodes despite authentication errors",
    "Partition data must be consistently removed from all nodes"
  ]
}